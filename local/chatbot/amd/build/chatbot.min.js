define(["jquery","core/templates"],function(s,c){return{init:function(t){var a=t.userid,n=t.username,i=t.coursename,t=M.util.image_url("logo","local_chatbot");function o(){var e,n,o,c,t=s("#chatbot-text").val().trim();t&&(s("#chatbot-text").val(""),r("user",t),e=function(){r("bot","Hi there"),console.log("Sent to backend",{text:t,userid:a,coursename:i})},n=["Understanding your question...","Formulating a response...","Referencing course modules..."],o=s("#chatbot-thinking"),c=0,function t(){c<n.length?(o.text(n[c]),c++,setTimeout(t,1e3)):(o.text(""),e())}())}function r(t,e){c.render("local_chatbot/message",{sender:t,text:e,sendername:"bot"===t?"sid":n}).done(function(t){s("#chatbot-messages").append(t),c.runTemplateJS(t);t=s("#chatbot-messages")[0];t.scrollTop=t.scrollHeight})}c.render("local_chatbot/chatbox",{iconurl:t}).done(function(t){var e;s("body").append(t),c.runTemplateJS(t),s("#chatbot-context").text(n+" ("+a+") - "+i),t=s("#chatbot-icon"),e=s("#chatbot-window"),t.on("click",function(){e.toggleClass("hidden")}),s("#chatbot-send").on("click",o),s("#chatbot-text").on("keydown",function(t){"Enter"!==t.key||t.shiftKey||(t.preventDefault(),o())})})}}});
